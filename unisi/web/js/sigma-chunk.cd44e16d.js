"use strict";(globalThis["webpackChunkuniqua"]=globalThis["webpackChunkuniqua"]||[]).push([[184],{6747:(e,t,i)=>{i.r(t),i.d(t,{Camera:()=>O,MouseCaptor:()=>te,Sigma:()=>be,TouchCaptor:()=>ne,default:()=>xe});var a=i(1109),n=i(4271),r=i(640),s=function(e){function t(){var e;return(0,n.b)(this,t),e=(0,n.c)(this,t),e.rawEmitter=e,e}return(0,n._)(t,e),(0,n.a)(t)}(r.EventEmitter),o=i(9235),h=i.n(o),d=i(520),l=function(e){return e},u=function(e){return e*e},c=function(e){return e*(2-e)},g=function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},v=function(e){return e*e*e},m=function(e){return--e*e*e+1},f=function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},p={linear:l,quadraticIn:u,quadraticOut:c,quadraticInOut:g,cubicIn:v,cubicOut:m,cubicInOut:f},y={easing:"quadraticInOut",duration:150};function b(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function x(e,t,i){return e[0]=t,e[4]="number"===typeof i?i:t,e}function C(e,t){var i=Math.sin(t),a=Math.cos(t);return e[0]=a,e[1]=i,e[3]=-i,e[4]=a,e}function w(e,t,i){return e[6]=t,e[7]=i,e}function E(e,t){var i=e[0],a=e[1],n=e[2],r=e[3],s=e[4],o=e[5],h=e[6],d=e[7],l=e[8],u=t[0],c=t[1],g=t[2],v=t[3],m=t[4],f=t[5],p=t[6],y=t[7],b=t[8];return e[0]=u*i+c*r+g*h,e[1]=u*a+c*s+g*d,e[2]=u*n+c*o+g*l,e[3]=v*i+m*r+f*h,e[4]=v*a+m*s+f*d,e[5]=v*n+m*o+f*l,e[6]=p*i+y*r+b*h,e[7]=p*a+y*s+b*d,e[8]=p*n+y*o+b*l,e}function k(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=e[0],n=e[1],r=e[3],s=e[4],o=e[6],h=e[7],d=t.x,l=t.y;return{x:d*a+l*r+o*i,y:d*n+l*s+h*i}}function L(e,t){var i=e.height/e.width,a=t.height/t.width;return i<1&&a>1||i>1&&a<1?1:Math.min(Math.max(a,1/a),Math.max(1/i,i))}function S(e,t,i,a,n){var r=e.angle,s=e.ratio,o=e.x,h=e.y,d=t.width,l=t.height,u=b(),c=Math.min(d,l)-2*a,g=L(t,i);return n?(E(u,w(b(),o,h)),E(u,x(b(),s)),E(u,C(b(),r)),E(u,x(b(),d/c/2/g,l/c/2/g))):(E(u,x(b(),c/d*2*g,c/l*2*g)),E(u,C(b(),-r)),E(u,x(b(),1/s)),E(u,w(b(),-o,-h))),u}function P(e,t,i){var a=k(e,{x:Math.cos(t.angle),y:Math.sin(t.angle)},0),n=a.x,r=a.y;return 1/Math.sqrt(Math.pow(n,2)+Math.pow(r,2))/i.width}function T(e){if(!e.order)return{x:[0,1],y:[0,1]};var t=1/0,i=-1/0,a=1/0,n=-1/0;return e.forEachNode((function(e,r){var s=r.x,o=r.y;s<t&&(t=s),s>i&&(i=s),o<a&&(a=o),o>n&&(n=o)})),{x:[t,i],y:[a,n]}}function D(e){if(!h()(e))throw new Error("Sigma: invalid graph instance.");e.forEachNode((function(e,t){if(!Number.isFinite(t.x)||!Number.isFinite(t.y))throw new Error("Sigma: Coordinates of node ".concat(e," are invalid. A node must have a numeric 'x' and 'y' attribute."))}))}function R(e,t,i){var a=document.createElement(e);if(t)for(var n in t)a.style[n]=t[n];if(i)for(var r in i)a.setAttribute(r,i[r]);return a}function N(){return"undefined"!==typeof window.devicePixelRatio?window.devicePixelRatio:1}function M(e,t,i){return i.sort((function(e,i){var a=t(e)||0,n=t(i)||0;return a<n?-1:a>n?1:0}))}function G(e){var t=(0,d._)(e.x,2),i=t[0],a=t[1],n=(0,d._)(e.y,2),r=n[0],s=n[1],o=Math.max(a-i,s-r),h=(a+i)/2,l=(s+r)/2;(0===o||Math.abs(o)===1/0||isNaN(o))&&(o=1),isNaN(h)&&(h=0),isNaN(l)&&(l=0);var u=function(e){return{x:.5+(e.x-h)/o,y:.5+(e.y-l)/o}};return u.applyTo=function(e){e.x=.5+(e.x-h)/o,e.y=.5+(e.y-l)/o},u.inverse=function(e){return{x:h+o*(e.x-.5),y:l+o*(e.y-.5)}},u.ratio=o,u}function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function z(e,t){var i=t.size;if(0!==i){var a=e.length;e.length+=i;var n=0;t.forEach((function(t){e[a+n]=t,n++}))}}function I(e){e=e||{};for(var t=0,i=arguments.length<=1?0:arguments.length-1;t<i;t++){var a=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];a&&Object.assign(e,a)}return e}var _={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:a.d,defaultDrawNodeLabel:a.b,defaultDrawNodeHover:a.c,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},A={circle:a.N},U={arrow:a.E,line:a.e};function H(e){if("number"!==typeof e.labelDensity||e.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var t=e.minCameraRatio,i=e.maxCameraRatio;if("number"===typeof t&&"number"===typeof i&&i<t)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function B(e){var t=I({},_,e);return t.nodeProgramClasses=I({},A,t.nodeProgramClasses),t.edgeProgramClasses=I({},U,t.edgeProgramClasses),t}var W=1.5,O=function(e){function t(){var e;return(0,n.b)(this,t),e=(0,n.c)(this,t),(0,a.a)(e,"x",.5),(0,a.a)(e,"y",.5),(0,a.a)(e,"angle",0),(0,a.a)(e,"ratio",1),(0,a.a)(e,"minRatio",null),(0,a.a)(e,"maxRatio",null),(0,a.a)(e,"enabledZooming",!0),(0,a.a)(e,"enabledPanning",!0),(0,a.a)(e,"enabledRotation",!0),(0,a.a)(e,"clean",null),(0,a.a)(e,"nextFrame",null),(0,a.a)(e,"previousState",null),(0,a.a)(e,"enabled",!0),e.previousState=e.getState(),e}return(0,n._)(t,e),(0,n.a)(t,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(e){return this.x===e.x&&this.y===e.y&&this.ratio===e.ratio&&this.angle===e.angle}},{key:"getPreviousState",value:function(){var e=this.previousState;return e?{x:e.x,y:e.y,angle:e.angle,ratio:e.ratio}:null}},{key:"getBoundedRatio",value:function(e){var t=e;return"number"===typeof this.minRatio&&(t=Math.max(t,this.minRatio)),"number"===typeof this.maxRatio&&(t=Math.min(t,this.maxRatio)),t}},{key:"validateState",value:function(e){var t={};return this.enabledPanning&&"number"===typeof e.x&&(t.x=e.x),this.enabledPanning&&"number"===typeof e.y&&(t.y=e.y),this.enabledZooming&&"number"===typeof e.ratio&&(t.ratio=this.getBoundedRatio(e.ratio)),this.enabledRotation&&"number"===typeof e.angle&&(t.angle=e.angle),this.clean?this.clean((0,a._)((0,a._)({},this.getState()),t)):t}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(e){if(!this.enabled)return this;this.previousState=this.getState();var t=this.validateState(e);return"number"===typeof t.x&&(this.x=t.x),"number"===typeof t.y&&(this.y=t.y),"number"===typeof t.ratio&&(this.ratio=t.ratio),"number"===typeof t.angle&&(this.angle=t.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(e){return this.setState(e(this.getState())),this}},{key:"animate",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(!n)return new Promise((function(a){return t.animate(e,i,a)}));if(this.enabled){var r=(0,a._)((0,a._)({},y),i),s=this.validateState(e),o="function"===typeof r.easing?r.easing:p[r.easing],h=Date.now(),d=this.getState(),l=function(){var e=(Date.now()-h)/r.duration;if(e>=1)return t.nextFrame=null,t.setState(s),void(t.animationCallback&&(t.animationCallback.call(null),t.animationCallback=void 0));var i=o(e),a={};"number"===typeof s.x&&(a.x=d.x+(s.x-d.x)*i),"number"===typeof s.y&&(a.y=d.y+(s.y-d.y)*i),t.enabledRotation&&"number"===typeof s.angle&&(a.angle=d.angle+(s.angle-d.angle)*i),"number"===typeof s.ratio&&(a.ratio=d.ratio+(s.ratio-d.ratio)*i),t.setState(a),t.nextFrame=requestAnimationFrame(l)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(l)):l(),this.animationCallback=n}}},{key:"animatedZoom",value:function(e){return e?"number"===typeof e?this.animate({ratio:this.ratio/e}):this.animate({ratio:this.ratio/(e.factor||W)},e):this.animate({ratio:this.ratio/W})}},{key:"animatedUnzoom",value:function(e){return e?"number"===typeof e?this.animate({ratio:this.ratio*e}):this.animate({ratio:this.ratio*(e.factor||W)},e):this.animate({ratio:this.ratio*W})}},{key:"animatedReset",value:function(e){return this.animate({x:.5,y:.5,ratio:1,angle:0},e)}},{key:"copy",value:function(){return t.from(this.getState())}}],[{key:"from",value:function(e){var i=new t;return i.setState(e)}}])}(s);function Z(e,t){var i=t.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}}function V(e,t){var i=(0,a._)((0,a._)({},Z(e,t)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){i.sigmaDefaultPrevented=!0},original:e});return i}function q(e){var t="x"in e?e:(0,a._)((0,a._)({},e.touches[0]||e.previousTouches[0]),{},{original:e.original,sigmaDefaultPrevented:e.sigmaDefaultPrevented,preventSigmaDefault:function(){e.sigmaDefaultPrevented=!0,t.sigmaDefaultPrevented=!0}});return t}function j(e,t){return(0,a._)((0,a._)({},V(e,t)),{},{delta:K(e)})}var Y=2;function X(e){for(var t=[],i=0,a=Math.min(e.length,Y);i<a;i++)t.push(e[i]);return t}function J(e,t,i){var a={touches:X(e.touches).map((function(e){return Z(e,i)})),previousTouches:t.map((function(e){return Z(e,i)})),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){a.sigmaDefaultPrevented=!0},original:e};return a}function K(e){if("undefined"!==typeof e.deltaY)return-3*e.deltaY/360;if("undefined"!==typeof e.detail)return e.detail/-9;throw new Error("Captor: could not extract delta from event.")}var Q=function(e){function t(e,i){var a;return(0,n.b)(this,t),a=(0,n.c)(this,t),a.container=e,a.renderer=i,a}return(0,n._)(t,e),(0,n.a)(t)}(s),$=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],ee=$.reduce((function(e,t){return(0,a._)((0,a._)({},e),{},(0,a.a)({},t,_[t]))}),{}),te=function(e){function t(e,i){var r;return(0,n.b)(this,t),r=(0,n.c)(this,t,[e,i]),(0,a.a)(r,"enabled",!0),(0,a.a)(r,"draggedEvents",0),(0,a.a)(r,"downStartTime",null),(0,a.a)(r,"lastMouseX",null),(0,a.a)(r,"lastMouseY",null),(0,a.a)(r,"isMouseDown",!1),(0,a.a)(r,"isMoving",!1),(0,a.a)(r,"movingTimeout",null),(0,a.a)(r,"startCameraState",null),(0,a.a)(r,"clicks",0),(0,a.a)(r,"doubleClickTimeout",null),(0,a.a)(r,"currentWheelDirection",0),(0,a.a)(r,"settings",ee),r.handleClick=r.handleClick.bind(r),r.handleRightClick=r.handleRightClick.bind(r),r.handleDown=r.handleDown.bind(r),r.handleUp=r.handleUp.bind(r),r.handleMove=r.handleMove.bind(r),r.handleWheel=r.handleWheel.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleEnter=r.handleEnter.bind(r),e.addEventListener("click",r.handleClick,{capture:!1}),e.addEventListener("contextmenu",r.handleRightClick,{capture:!1}),e.addEventListener("mousedown",r.handleDown,{capture:!1}),e.addEventListener("wheel",r.handleWheel,{capture:!1}),e.addEventListener("mouseleave",r.handleLeave,{capture:!1}),e.addEventListener("mouseenter",r.handleEnter,{capture:!1}),document.addEventListener("mousemove",r.handleMove,{capture:!1}),document.addEventListener("mouseup",r.handleUp,{capture:!1}),r}return(0,n._)(t,e),(0,n.a)(t,[{key:"kill",value:function(){var e=this.container;e.removeEventListener("click",this.handleClick),e.removeEventListener("contextmenu",this.handleRightClick),e.removeEventListener("mousedown",this.handleDown),e.removeEventListener("wheel",this.handleWheel),e.removeEventListener("mouseleave",this.handleLeave),e.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(e){var t=this;if(this.enabled){if(this.clicks++,2===this.clicks)return this.clicks=0,"number"===typeof this.doubleClickTimeout&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(e);setTimeout((function(){t.clicks=0,t.doubleClickTimeout=null}),this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",V(e,this.container))}}},{key:"handleRightClick",value:function(e){this.enabled&&this.emit("rightClick",V(e,this.container))}},{key:"handleDoubleClick",value:function(e){if(this.enabled){e.preventDefault(),e.stopPropagation();var t=V(e,this.container);if(this.emit("doubleClick",t),!t.sigmaDefaultPrevented){var i=this.renderer.getCamera(),a=i.getBoundedRatio(i.getState().ratio/this.settings.doubleClickZoomingRatio);i.animate(this.renderer.getViewportZoomedState(Z(e,this.container),a),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(e){if(this.enabled){if(0===e.button){this.startCameraState=this.renderer.getCamera().getState();var t=Z(e,this.container),i=t.x,a=t.y;this.lastMouseX=i,this.lastMouseY=a,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",V(e,this.container))}}},{key:"handleUp",value:function(e){var t=this;if(this.enabled&&this.isMouseDown){var i=this.renderer.getCamera();this.isMouseDown=!1,"number"===typeof this.movingTimeout&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var a=Z(e,this.container),n=a.x,r=a.y,s=i.getState(),o=i.getPreviousState()||{x:0,y:0};this.isMoving?i.animate({x:s.x+this.settings.inertiaRatio*(s.x-o.x),y:s.y+this.settings.inertiaRatio*(s.y-o.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):this.lastMouseX===n&&this.lastMouseY===r||i.setState({x:s.x,y:s.y}),this.isMoving=!1,setTimeout((function(){var e=t.draggedEvents>0;t.draggedEvents=0,e&&t.renderer.getSetting("hideEdgesOnMove")&&t.renderer.refresh()}),0),this.emit("mouseup",V(e,this.container))}}},{key:"handleMove",value:function(e){var t=this;if(this.enabled){var i=V(e,this.container);if(this.emit("mousemovebody",i),e.target!==this.container&&e.composedPath()[0]!==this.container||this.emit("mousemove",i),!i.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,"number"===typeof this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout((function(){t.movingTimeout=null,t.isMoving=!1}),this.settings.dragTimeout);var a=this.renderer.getCamera(),n=Z(e,this.container),r=n.x,s=n.y,o=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),h=this.renderer.viewportToFramedGraph({x:r,y:s}),d=o.x-h.x,l=o.y-h.y,u=a.getState(),c=u.x+d,g=u.y+l;a.setState({x:c,y:g}),this.lastMouseX=r,this.lastMouseY=s,e.preventDefault(),e.stopPropagation()}}}},{key:"handleLeave",value:function(e){this.emit("mouseleave",V(e,this.container))}},{key:"handleEnter",value:function(e){this.emit("mouseenter",V(e,this.container))}},{key:"handleWheel",value:function(e){var t=this,i=this.renderer.getCamera();if(this.enabled&&i.enabledZooming){var a=K(e);if(a){var n=j(e,this.container);if(this.emit("wheel",n),n.sigmaDefaultPrevented)return e.preventDefault(),void e.stopPropagation();var r=i.getState().ratio,s=a>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,o=i.getBoundedRatio(r*s),h=a>0?1:-1,d=Date.now();r!==o&&(e.preventDefault(),e.stopPropagation(),this.currentWheelDirection===h&&this.lastWheelTriggerTime&&d-this.lastWheelTriggerTime<this.settings.zoomDuration/5||(i.animate(this.renderer.getViewportZoomedState(Z(e,this.container),o),{easing:"quadraticOut",duration:this.settings.zoomDuration},(function(){t.currentWheelDirection=0})),this.currentWheelDirection=h,this.lastWheelTriggerTime=d))}}}},{key:"setSettings",value:function(e){this.settings=e}}])}(Q),ie=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],ae=ie.reduce((function(e,t){return(0,a._)((0,a._)({},e),{},(0,a.a)({},t,_[t]))}),{}),ne=function(e){function t(e,i){var r;return(0,n.b)(this,t),r=(0,n.c)(this,t,[e,i]),(0,a.a)(r,"enabled",!0),(0,a.a)(r,"isMoving",!1),(0,a.a)(r,"hasMoved",!1),(0,a.a)(r,"touchMode",0),(0,a.a)(r,"startTouchesPositions",[]),(0,a.a)(r,"lastTouches",[]),(0,a.a)(r,"lastTap",null),(0,a.a)(r,"settings",ae),r.handleStart=r.handleStart.bind(r),r.handleLeave=r.handleLeave.bind(r),r.handleMove=r.handleMove.bind(r),e.addEventListener("touchstart",r.handleStart,{capture:!1}),e.addEventListener("touchcancel",r.handleLeave,{capture:!1}),document.addEventListener("touchend",r.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",r.handleMove,{capture:!1,passive:!1}),r}return(0,n._)(t,e),(0,n.a)(t,[{key:"kill",value:function(){var e=this.container;e.removeEventListener("touchstart",this.handleStart),e.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(e){var t=this;if(this.enabled){e.preventDefault();var i=X(e.touches);if(this.touchMode=i.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=i.map((function(e){return Z(e,t.container)})),2===this.touchMode){var a=(0,d._)(this.startTouchesPositions,2),n=a[0],r=n.x,s=n.y,o=a[1],h=o.x,l=o.y;this.startTouchesAngle=Math.atan2(l-s,h-r),this.startTouchesDistance=Math.sqrt(Math.pow(h-r,2)+Math.pow(l-s,2))}this.emit("touchdown",J(e,this.lastTouches,this.container)),this.lastTouches=i,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(e){if(this.enabled&&this.startTouchesPositions.length){switch(e.cancelable&&e.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(1===e.touches.length){this.handleStart(e),e.preventDefault();break}case 1:if(this.isMoving){var t=this.renderer.getCamera(),i=t.getState(),a=t.getPreviousState()||{x:0,y:0};t.animate({x:i.x+this.settings.inertiaRatio*(i.x-a.x),y:i.y+this.settings.inertiaRatio*(i.y-a.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",J(e,this.lastTouches,this.container)),!e.touches.length){var n=Z(this.lastTouches[0],this.container),r=this.startTouchesPositions[0],s=Math.pow(n.x-r.x,2)+Math.pow(n.y-r.y,2);if(!e.touches.length&&s<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var o=J(e,this.lastTouches,this.container);if(this.emit("doubletap",o),this.lastTap=null,!o.sigmaDefaultPrevented){var h=this.renderer.getCamera(),d=h.getBoundedRatio(h.getState().ratio/this.settings.doubleClickZoomingRatio);h.animate(this.renderer.getViewportZoomedState(n,d),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var l=J(e,this.lastTouches,this.container);this.emit("tap",l),this.lastTap={time:Date.now(),position:l.touches[0]||l.previousTouches[0]}}}this.lastTouches=X(e.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(e){var t=this;if(this.enabled&&this.startTouchesPositions.length){e.preventDefault();var i=X(e.touches),a=i.map((function(e){return Z(e,t.container)})),n=this.lastTouches;this.lastTouches=i,this.lastTouchesPositions=a;var r=J(e,n,this.container);if(this.emit("touchmove",r),!r.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=a.some((function(e,i){var a=t.startTouchesPositions[i];return a&&(e.x!==a.x||e.y!==a.y)}))),this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout((function(){t.isMoving=!1}),this.settings.dragTimeout);var s=this.renderer.getCamera(),o=this.startCameraState,h=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:var d=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),l=d.x,u=d.y,c=this.renderer.viewportToFramedGraph(a[0]),g=c.x,v=c.y;s.setState({x:o.x+l-g,y:o.y+u-v});break;case 2:var m={x:.5,y:.5,angle:0,ratio:1},f=a[0],p=f.x,y=f.y,b=a[1],x=b.x,C=b.y,w=Math.atan2(C-y,x-p)-this.startTouchesAngle,E=Math.hypot(C-y,x-p)/this.startTouchesDistance,k=s.getBoundedRatio(o.ratio/E);m.ratio=k,m.angle=o.angle+w;var L=this.getDimensions(),S=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:o}),P=Math.min(L.width,L.height)-2*h,T=P/L.width,D=P/L.height,R=k/P,N=p-P/2/T,M=y-P/2/D,G=[N*Math.cos(-m.angle)-M*Math.sin(-m.angle),M*Math.cos(-m.angle)+N*Math.sin(-m.angle)];N=G[0],M=G[1],m.x=S.x-N*R,m.y=S.y+M*R,s.setState(m);break}}}}},{key:"setSettings",value:function(e){this.settings=e}}])}(Q);function re(e){if(Array.isArray(e))return(0,d.a)(e)}function se(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function oe(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function he(e){return re(e)||se(e)||(0,d.b)(e)||oe()}function de(e,t){if(null==e)return{};var i={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(t.includes(a))continue;i[a]=e[a]}return i}function le(e,t){if(null==e)return{};var i,a,n=de(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)i=r[a],t.includes(i)||{}.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var ue=function(){function e(t,i){(0,n.b)(this,e),this.key=t,this.size=i}return(0,n.a)(e,null,[{key:"compare",value:function(e,t){return e.size>t.size?-1:e.size<t.size||e.key>t.key?1:-1}}])}(),ce=function(){function e(){(0,n.b)(this,e),(0,a.a)(this,"width",0),(0,a.a)(this,"height",0),(0,a.a)(this,"cellSize",0),(0,a.a)(this,"columns",0),(0,a.a)(this,"rows",0),(0,a.a)(this,"cells",{})}return(0,n.a)(e,[{key:"resizeAndClear",value:function(e,t){this.width=e.width,this.height=e.height,this.cellSize=t,this.columns=Math.ceil(e.width/t),this.rows=Math.ceil(e.height/t),this.cells={}}},{key:"getIndex",value:function(e){var t=Math.floor(e.x/this.cellSize),i=Math.floor(e.y/this.cellSize);return i*this.columns+t}},{key:"add",value:function(e,t,i){var a=new ue(e,t),n=this.getIndex(i),r=this.cells[n];r||(r=[],this.cells[n]=r),r.push(a)}},{key:"organize",value:function(){for(var e in this.cells){var t=this.cells[e];t.sort(ue.compare)}}},{key:"getLabelsToDisplay",value:function(e,t){var i=this.cellSize*this.cellSize,a=i/e/e,n=a*t/i,r=Math.ceil(n),s=[];for(var o in this.cells)for(var h=this.cells[o],d=0;d<Math.min(r,h.length);d++)s.push(h[d].key);return s}}])}();function ge(e){var t=e.graph,i=e.hoveredNode,a=e.highlightedNodes,n=e.displayedNodeLabels,r=[];return t.forEachEdge((function(e,t,s,o){(s===i||o===i||a.has(s)||a.has(o)||n.has(s)&&n.has(o))&&r.push(e)})),r}var ve=150,me=50,fe=Object.prototype.hasOwnProperty;function pe(e,t,i){if(!fe.call(i,"x")||!fe.call(i,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(t,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return i.color||(i.color=e.defaultNodeColor),i.label||""===i.label||(i.label=null),void 0!==i.label&&null!==i.label?i.label=""+i.label:i.label=null,i.size||(i.size=2),fe.call(i,"hidden")||(i.hidden=!1),fe.call(i,"highlighted")||(i.highlighted=!1),fe.call(i,"forceLabel")||(i.forceLabel=!1),i.type&&""!==i.type||(i.type=e.defaultNodeType),i.zIndex||(i.zIndex=0),i}function ye(e,t,i){return i.color||(i.color=e.defaultEdgeColor),i.label||(i.label=""),i.size||(i.size=.5),fe.call(i,"hidden")||(i.hidden=!1),fe.call(i,"forceLabel")||(i.forceLabel=!1),i.type&&""!==i.type||(i.type=e.defaultEdgeType),i.zIndex||(i.zIndex=0),i}var be=function(e){function t(e,i){var r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if((0,n.b)(this,t),r=(0,n.c)(this,t),(0,a.a)(r,"elements",{}),(0,a.a)(r,"canvasContexts",{}),(0,a.a)(r,"webGLContexts",{}),(0,a.a)(r,"pickingLayers",new Set),(0,a.a)(r,"textures",{}),(0,a.a)(r,"frameBuffers",{}),(0,a.a)(r,"activeListeners",{}),(0,a.a)(r,"labelGrid",new ce),(0,a.a)(r,"nodeDataCache",{}),(0,a.a)(r,"edgeDataCache",{}),(0,a.a)(r,"nodeProgramIndex",{}),(0,a.a)(r,"edgeProgramIndex",{}),(0,a.a)(r,"nodesWithForcedLabels",new Set),(0,a.a)(r,"edgesWithForcedLabels",new Set),(0,a.a)(r,"nodeExtent",{x:[0,1],y:[0,1]}),(0,a.a)(r,"nodeZExtent",[1/0,-1/0]),(0,a.a)(r,"edgeZExtent",[1/0,-1/0]),(0,a.a)(r,"matrix",b()),(0,a.a)(r,"invMatrix",b()),(0,a.a)(r,"correctionRatio",1),(0,a.a)(r,"customBBox",null),(0,a.a)(r,"normalizationFunction",G({x:[0,1],y:[0,1]})),(0,a.a)(r,"graphToViewportRatio",1),(0,a.a)(r,"itemIDsIndex",{}),(0,a.a)(r,"nodeIndices",{}),(0,a.a)(r,"edgeIndices",{}),(0,a.a)(r,"width",0),(0,a.a)(r,"height",0),(0,a.a)(r,"pixelRatio",N()),(0,a.a)(r,"pickingDownSizingRatio",2*r.pixelRatio),(0,a.a)(r,"displayedNodeLabels",new Set),(0,a.a)(r,"displayedEdgeLabels",new Set),(0,a.a)(r,"highlightedNodes",new Set),(0,a.a)(r,"hoveredNode",null),(0,a.a)(r,"hoveredEdge",null),(0,a.a)(r,"renderFrame",null),(0,a.a)(r,"renderHighlightedNodesFrame",null),(0,a.a)(r,"needToProcess",!1),(0,a.a)(r,"checkEdgesEventsFrame",null),(0,a.a)(r,"nodePrograms",{}),(0,a.a)(r,"nodeHoverPrograms",{}),(0,a.a)(r,"edgePrograms",{}),r.settings=B(s),H(r.settings),D(e),!(i instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");for(var o in r.graph=e,r.container=i,r.createWebGLContext("edges",{picking:s.enableEdgeEvents}),r.createCanvasContext("edgeLabels"),r.createWebGLContext("nodes",{picking:!0}),r.createCanvasContext("labels"),r.createCanvasContext("hovers"),r.createWebGLContext("hoverNodes"),r.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),r.resize(),r.settings.nodeProgramClasses)r.registerNodeProgram(o,r.settings.nodeProgramClasses[o],r.settings.nodeHoverProgramClasses[o]);for(var h in r.settings.edgeProgramClasses)r.registerEdgeProgram(h,r.settings.edgeProgramClasses[h]);return r.camera=new O,r.bindCameraHandlers(),r.mouseCaptor=new te(r.elements.mouse,r),r.mouseCaptor.setSettings(r.settings),r.touchCaptor=new ne(r.elements.mouse,r),r.touchCaptor.setSettings(r.settings),r.bindEventHandlers(),r.bindGraphHandlers(),r.handleSettingsUpdate(),r.refresh(),r}return(0,n._)(t,e),(0,n.a)(t,[{key:"registerNodeProgram",value:function(e,t,i){return this.nodePrograms[e]&&this.nodePrograms[e].kill(),this.nodeHoverPrograms[e]&&this.nodeHoverPrograms[e].kill(),this.nodePrograms[e]=new t(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[e]=new(i||t)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(e,t){return this.edgePrograms[e]&&this.edgePrograms[e].kill(),this.edgePrograms[e]=new t(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(e){if(this.nodePrograms[e]){var t=this.nodePrograms,i=t[e],a=le(t,[e].map(n.d));i.kill(),this.nodePrograms=a}if(this.nodeHoverPrograms[e]){var r=this.nodeHoverPrograms,s=r[e],o=le(r,[e].map(n.d));s.kill(),this.nodePrograms=o}return this}},{key:"unregisterEdgeProgram",value:function(e){if(this.edgePrograms[e]){var t=this.edgePrograms,i=t[e],a=le(t,[e].map(n.d));i.kill(),this.edgePrograms=a}return this}},{key:"resetWebGLTexture",value:function(e){var t=this.webGLContexts[e],i=this.frameBuffers[e],a=this.textures[e];a&&t.deleteTexture(a);var n=t.createTexture();return t.bindFramebuffer(t.FRAMEBUFFER,i),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0),this.textures[e]=n,this}},{key:"bindCameraHandlers",value:function(){var e=this;return this.activeListeners.camera=function(){e.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(e){var t=e.x,i=e.y,a=(0,d.g)(this.webGLContexts.nodes,this.frameBuffers.nodes,t,i,this.pixelRatio,this.pickingDownSizingRatio),n=d.c.apply(void 0,he(a)),r=this.itemIDsIndex[n];return r&&"node"===r.type?r.id:null}},{key:"bindEventHandlers",value:function(){var e=this;this.activeListeners.handleResize=function(){e.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(t){var i=q(t),n={event:i,preventSigmaDefault:function(){i.preventSigmaDefault()}},r=e.getNodeAtPosition(i);if(r&&e.hoveredNode!==r&&!e.nodeDataCache[r].hidden)return e.hoveredNode&&e.emit("leaveNode",(0,a._)((0,a._)({},n),{},{node:e.hoveredNode})),e.hoveredNode=r,e.emit("enterNode",(0,a._)((0,a._)({},n),{},{node:r})),void e.scheduleHighlightedNodesRender();if(e.hoveredNode&&e.getNodeAtPosition(i)!==e.hoveredNode){var s=e.hoveredNode;return e.hoveredNode=null,e.emit("leaveNode",(0,a._)((0,a._)({},n),{},{node:s})),void e.scheduleHighlightedNodesRender()}if(e.settings.enableEdgeEvents){var o=e.hoveredNode?null:e.getEdgeAtPoint(n.event.x,n.event.y);o!==e.hoveredEdge&&(e.hoveredEdge&&e.emit("leaveEdge",(0,a._)((0,a._)({},n),{},{edge:e.hoveredEdge})),o&&e.emit("enterEdge",(0,a._)((0,a._)({},n),{},{edge:o})),e.hoveredEdge=o)}},this.activeListeners.handleMoveBody=function(t){var i=q(t);e.emit("moveBody",{event:i,preventSigmaDefault:function(){i.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(t){var i=q(t),n={event:i,preventSigmaDefault:function(){i.preventSigmaDefault()}};e.hoveredNode&&(e.emit("leaveNode",(0,a._)((0,a._)({},n),{},{node:e.hoveredNode})),e.scheduleHighlightedNodesRender()),e.settings.enableEdgeEvents&&e.hoveredEdge&&(e.emit("leaveEdge",(0,a._)((0,a._)({},n),{},{edge:e.hoveredEdge})),e.scheduleHighlightedNodesRender()),e.emit("leaveStage",(0,a._)({},n))},this.activeListeners.handleEnter=function(t){var i=q(t),n={event:i,preventSigmaDefault:function(){i.preventSigmaDefault()}};e.emit("enterStage",(0,a._)({},n))};var t=function(t){return function(i){var n=q(i),r={event:n,preventSigmaDefault:function(){n.preventSigmaDefault()}},s=e.getNodeAtPosition(n);if(s)return e.emit("".concat(t,"Node"),(0,a._)((0,a._)({},r),{},{node:s}));if(e.settings.enableEdgeEvents){var o=e.getEdgeAtPoint(n.x,n.y);if(o)return e.emit("".concat(t,"Edge"),(0,a._)((0,a._)({},r),{},{edge:o}))}return e.emit("".concat(t,"Stage"),r)}};return this.activeListeners.handleClick=t("click"),this.activeListeners.handleRightClick=t("rightClick"),this.activeListeners.handleDoubleClick=t("doubleClick"),this.activeListeners.handleWheel=t("wheel"),this.activeListeners.handleDown=t("down"),this.activeListeners.handleUp=t("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var e=this,t=this.graph,i=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(a){var n,r=null===(n=a.hints)||void 0===n?void 0:n.attributes;e.graph.forEachNode((function(t){return e.updateNode(t)}));var s=!r||r.some((function(e){return i.has(e)}));e.refresh({partialGraph:{nodes:t.nodes()},skipIndexation:!s,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(i){var a,n=null===(a=i.hints)||void 0===a?void 0:a.attributes;e.graph.forEachEdge((function(t){return e.updateEdge(t)}));var r=n&&["zIndex","type"].some((function(e){return null===n||void 0===n?void 0:n.includes(e)}));e.refresh({partialGraph:{edges:t.edges()},skipIndexation:!r,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(t){var i=t.key;e.addNode(i),e.refresh({partialGraph:{nodes:[i]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(t){var i=t.key;e.refresh({partialGraph:{nodes:[i]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(t){var i=t.key;e.removeNode(i),e.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(t){var i=t.key;e.addEdge(i),e.refresh({partialGraph:{edges:[i]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(t){var i=t.key;e.refresh({partialGraph:{edges:[i]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(t){var i=t.key;e.removeEdge(i),e.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){e.clearEdgeState(),e.clearEdgeIndices(),e.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){e.clearEdgeState(),e.clearNodeState(),e.clearEdgeIndices(),e.clearNodeIndices(),e.refresh({schedule:!0})},t.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),t.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),t.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),t.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),t.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),t.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),t.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),t.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),t.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),t.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var e=this.graph;e.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),e.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),e.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),e.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),e.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),e.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),e.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),e.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),e.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),e.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(e,t){var i=(0,d.g)(this.webGLContexts.edges,this.frameBuffers.edges,e,t,this.pixelRatio,this.pickingDownSizingRatio),a=d.c.apply(void 0,he(i)),n=this.itemIDsIndex[a];return n&&"edge"===n.type?n.id:null}},{key:"process",value:function(){var e=this;this.emit("beforeProcess");var t=this.graph,i=this.settings,a=this.getDimensions();if(this.nodeExtent=T(this.graph),!this.settings.autoRescale){var n=a.width,r=a.height,s=this.nodeExtent,o=s.x,h=s.y;this.nodeExtent={x:[(o[0]+o[1])/2-n/2,(o[0]+o[1])/2+n/2],y:[(h[0]+h[1])/2-r/2,(h[0]+h[1])/2+r/2]}}this.normalizationFunction=G(this.customBBox||this.nodeExtent);var d=new O,l=S(d.getState(),a,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(a,i.labelGridCellSize);for(var u={},c={},g={},v={},m=1,f=t.nodes(),p=0,y=f.length;p<y;p++){var b=f[p],x=this.nodeDataCache[b],C=t.getNodeAttributes(b);x.x=C.x,x.y=C.y,this.normalizationFunction.applyTo(x),"string"!==typeof x.label||x.hidden||this.labelGrid.add(b,x.size,this.framedGraphToViewport(x,{matrix:l})),u[x.type]=(u[x.type]||0)+1}for(var w in this.labelGrid.organize(),this.nodePrograms){if(!fe.call(this.nodePrograms,w))throw new Error('Sigma: could not find a suitable program for node type "'.concat(w,'"!'));this.nodePrograms[w].reallocate(u[w]||0),u[w]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(f=M(this.nodeZExtent,(function(t){return e.nodeDataCache[t].zIndex}),f));for(var E=0,k=f.length;E<k;E++){var L=f[E];c[L]=m,v[c[L]]={type:"node",id:L},m++;var P=this.nodeDataCache[L];this.addNodeToProgram(L,c[L],u[P.type]++)}for(var D={},R=t.edges(),N=0,F=R.length;N<F;N++){var z=R[N],I=this.edgeDataCache[z];D[I.type]=(D[I.type]||0)+1}for(var _ in this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(R=M(this.edgeZExtent,(function(t){return e.edgeDataCache[t].zIndex}),R)),this.edgePrograms){if(!fe.call(this.edgePrograms,_))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(_,'"!'));this.edgePrograms[_].reallocate(D[_]||0),D[_]=0}for(var A=0,U=R.length;A<U;A++){var H=R[A];g[H]=m,v[g[H]]={type:"edge",id:H},m++;var B=this.edgeDataCache[H];this.addEdgeToProgram(H,g[H],D[B.type]++)}return this.itemIDsIndex=v,this.nodeIndices=c,this.edgeIndices=g,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(e){var t=this,i=this.settings;if(this.camera.minRatio=i.minCameraRatio,this.camera.maxRatio=i.maxCameraRatio,this.camera.enabledZooming=i.enableCameraZooming,this.camera.enabledPanning=i.enableCameraPanning,this.camera.enabledRotation=i.enableCameraRotation,i.cameraPanBoundaries?this.camera.clean=function(e){return t.cleanCameraState(e,i.cameraPanBoundaries&&"object"===F(i.cameraPanBoundaries)?i.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),e){if(e.edgeProgramClasses!==i.edgeProgramClasses){for(var a in i.edgeProgramClasses)i.edgeProgramClasses[a]!==e.edgeProgramClasses[a]&&this.registerEdgeProgram(a,i.edgeProgramClasses[a]);for(var n in e.edgeProgramClasses)i.edgeProgramClasses[n]||this.unregisterEdgeProgram(n)}if(e.nodeProgramClasses!==i.nodeProgramClasses||e.nodeHoverProgramClasses!==i.nodeHoverProgramClasses){for(var r in i.nodeProgramClasses)i.nodeProgramClasses[r]===e.nodeProgramClasses[r]&&i.nodeHoverProgramClasses[r]===e.nodeHoverProgramClasses[r]||this.registerNodeProgram(r,i.nodeProgramClasses[r],i.nodeHoverProgramClasses[r]);for(var s in e.nodeProgramClasses)i.nodeProgramClasses[s]||this.unregisterNodeProgram(s)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.tolerance,n=void 0===i?0:i,r=t.boundaries,s=(0,a._)({},e),o=r||this.nodeExtent,h=(0,d._)(o.x,2),l=h[0],u=h[1],c=(0,d._)(o.y,2),g=c[0],v=c[1],m=[this.graphToViewport({x:l,y:g},{cameraState:e}),this.graphToViewport({x:u,y:g},{cameraState:e}),this.graphToViewport({x:l,y:v},{cameraState:e}),this.graphToViewport({x:u,y:v},{cameraState:e})],f=1/0,p=-1/0,y=1/0,b=-1/0;m.forEach((function(e){var t=e.x,i=e.y;f=Math.min(f,t),p=Math.max(p,t),y=Math.min(y,i),b=Math.max(b,i)}));var x=p-f,C=b-y,w=this.getDimensions(),E=w.width,k=w.height,L=0,S=0;if(x>=E?p<E-n?L=p-(E-n):f>n&&(L=f-n):p>E+n?L=p-(E+n):f<-n&&(L=f+n),C>=k?b<k-n?S=b-(k-n):y>n&&(S=y-n):b>k+n?S=b-(k+n):y<-n&&(S=y+n),L||S){var P=this.viewportToFramedGraph({x:0,y:0},{cameraState:e}),T=this.viewportToFramedGraph({x:L,y:S},{cameraState:e});L=T.x-P.x,S=T.y-P.y,s.x+=L,s.y+=S}return s}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var e=this.camera.getState(),t=this.labelGrid.getLabelsToDisplay(e.ratio,this.settings.labelDensity);z(t,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var i=this.canvasContexts.labels,n=0,r=t.length;n<r;n++){var s=t[n],o=this.nodeDataCache[s];if(!this.displayedNodeLabels.has(s)&&!o.hidden){var h=this.framedGraphToViewport(o),d=h.x,l=h.y,u=this.scaleSize(o.size);if((o.forceLabel||!(u<this.settings.labelRenderedSizeThreshold))&&!(d<-ve||d>this.width+ve||l<-me||l>this.height+me)){this.displayedNodeLabels.add(s);var c=this.settings.defaultDrawNodeLabel,g=this.nodePrograms[o.type],v=(null===g||void 0===g?void 0:g.drawLabel)||c;v(i,(0,a._)((0,a._)({key:s},o),{},{size:u,x:d,y:l}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var e=this.canvasContexts.edgeLabels;e.clearRect(0,0,this.width,this.height);var t=ge({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});z(t,this.edgesWithForcedLabels);for(var i=new Set,n=0,r=t.length;n<r;n++){var s=t[n],o=this.graph.extremities(s),h=this.nodeDataCache[o[0]],d=this.nodeDataCache[o[1]],l=this.edgeDataCache[s];if(!i.has(s)&&!(l.hidden||h.hidden||d.hidden)){var u=this.settings.defaultDrawEdgeLabel,c=this.edgePrograms[l.type],g=(null===c||void 0===c?void 0:c.drawLabel)||u;g(e,(0,a._)((0,a._)({key:s},l),{},{size:this.scaleSize(l.size)}),(0,a._)((0,a._)((0,a._)({key:o[0]},h),this.framedGraphToViewport(h)),{},{size:this.scaleSize(h.size)}),(0,a._)((0,a._)((0,a._)({key:o[1]},d),this.framedGraphToViewport(d)),{},{size:this.scaleSize(d.size)}),this.settings),i.add(s)}}return this.displayedEdgeLabels=i,this}},{key:"renderHighlightedNodes",value:function(){var e=this,t=this.canvasContexts.hovers;t.clearRect(0,0,this.width,this.height);var i=function(i){var n=e.nodeDataCache[i],r=e.framedGraphToViewport(n),s=r.x,o=r.y,h=e.scaleSize(n.size),d=e.settings.defaultDrawNodeHover,l=e.nodePrograms[n.type],u=(null===l||void 0===l?void 0:l.drawHover)||d;u(t,(0,a._)((0,a._)({key:i},n),{},{size:h,x:s,y:o}),e.settings)},n=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&n.push(this.hoveredNode),this.highlightedNodes.forEach((function(t){t!==e.hoveredNode&&n.push(t)})),n.forEach((function(e){return i(e)}));var r={};for(var s in n.forEach((function(t){var i=e.nodeDataCache[t].type;r[i]=(r[i]||0)+1})),this.nodeHoverPrograms)this.nodeHoverPrograms[s].reallocate(r[s]||0),r[s]=0;n.forEach((function(t){var i=e.nodeDataCache[t];e.nodeHoverPrograms[i.type].process(0,r[i.type]++,i)})),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var o=this.getRenderParams();for(var h in this.nodeHoverPrograms){var d=this.nodeHoverPrograms[h];d.render(o)}}},{key:"scheduleHighlightedNodesRender",value:function(){var e=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame((function(){e.renderHighlightedNodesFrame=null,e.renderHighlightedNodes(),e.renderEdgeLabels()})))}},{key:"render",value:function(){var e=this;this.emit("beforeRender");var t=function(){return e.emit("afterRender"),e};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach((function(t){return e.resetWebGLTexture(t)})),!this.graph.order)return t();var i=this.mouseCaptor,a=this.camera.isAnimated()||i.isMoving||i.draggedEvents||i.currentWheelDirection,n=this.camera.getState(),r=this.getDimensions(),s=this.getGraphDimensions(),o=this.getStagePadding();this.matrix=S(n,r,s,o),this.invMatrix=S(n,r,s,o,!0),this.correctionRatio=P(this.matrix,n,r),this.graphToViewportRatio=this.getGraphToViewportRatio();var h=this.getRenderParams();for(var d in this.nodePrograms){var l=this.nodePrograms[d];l.render(h)}if(!this.settings.hideEdgesOnMove||!a)for(var u in this.edgePrograms){var c=this.edgePrograms[u];c.render(h)}return this.settings.hideLabelsOnMove&&a||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),t()}},{key:"addNode",value:function(e){var t=Object.assign({},this.graph.getNodeAttributes(e));this.settings.nodeReducer&&(t=this.settings.nodeReducer(e,t));var i=pe(this.settings,e,t);this.nodeDataCache[e]=i,this.nodesWithForcedLabels["delete"](e),i.forceLabel&&!i.hidden&&this.nodesWithForcedLabels.add(e),this.highlightedNodes["delete"](e),i.highlighted&&!i.hidden&&this.highlightedNodes.add(e),this.settings.zIndex&&(i.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=i.zIndex),i.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=i.zIndex))}},{key:"updateNode",value:function(e){this.addNode(e);var t=this.nodeDataCache[e];this.normalizationFunction.applyTo(t)}},{key:"removeNode",value:function(e){delete this.nodeDataCache[e],delete this.nodeProgramIndex[e],this.highlightedNodes["delete"](e),this.hoveredNode===e&&(this.hoveredNode=null),this.nodesWithForcedLabels["delete"](e)}},{key:"addEdge",value:function(e){var t=Object.assign({},this.graph.getEdgeAttributes(e));this.settings.edgeReducer&&(t=this.settings.edgeReducer(e,t));var i=ye(this.settings,e,t);this.edgeDataCache[e]=i,this.edgesWithForcedLabels["delete"](e),i.forceLabel&&!i.hidden&&this.edgesWithForcedLabels.add(e),this.settings.zIndex&&(i.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=i.zIndex),i.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=i.zIndex))}},{key:"updateEdge",value:function(e){this.addEdge(e)}},{key:"removeEdge",value:function(e){delete this.edgeDataCache[e],delete this.edgeProgramIndex[e],this.hoveredEdge===e&&(this.hoveredEdge=null),this.edgesWithForcedLabels["delete"](e)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new ce,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0]}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(e,t,i){var a=this.nodeDataCache[e],n=this.nodePrograms[a.type];if(!n)throw new Error('Sigma: could not find a suitable program for node type "'.concat(a.type,'"!'));n.process(t,i,a),this.nodeProgramIndex[e]=i}},{key:"addEdgeToProgram",value:function(e,t,i){var a=this.edgeDataCache[e],n=this.edgePrograms[a.type];if(!n)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(a.type,'"!'));var r=this.graph.extremities(e),s=this.nodeDataCache[r[0]],o=this.nodeDataCache[r[1]];n.process(t,i,s,o,a),this.edgeProgramIndex[e]=i}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var e=this.settings,t=e.stagePadding,i=e.autoRescale;return i&&t||0}},{key:"createLayer",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.elements[e])throw new Error('Sigma: a layer named "'.concat(e,'" already exists'));var a=R(t,{position:"absolute"},{class:"sigma-".concat(e)});return i.style&&Object.assign(a.style,i.style),this.elements[e]=a,"beforeLayer"in i&&i.beforeLayer?this.elements[i.beforeLayer].before(a):"afterLayer"in i&&i.afterLayer?this.elements[i.afterLayer].after(a):this.container.appendChild(a),a}},{key:"createCanvas",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.createLayer(e,"canvas",t)}},{key:"createCanvasContext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.createCanvas(e,t),a={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[e]=i.getContext("2d",a),this}},{key:"createWebGLContext",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(null===t||void 0===t?void 0:t.canvas)||this.createCanvas(e,t);t.hidden&&i.remove();var n,r=(0,a._)({preserveDrawingBuffer:!1,antialias:!1},t);n=i.getContext("webgl2",r),n||(n=i.getContext("webgl",r)),n||(n=i.getContext("experimental-webgl",r));var s=n;if(this.webGLContexts[e]=s,s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),t.picking){this.pickingLayers.add(e);var o=s.createFramebuffer();if(!o)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(e));this.frameBuffers[e]=o}return s}},{key:"killLayer",value:function(e){var t=this.elements[e];if(!t)throw new Error("Sigma: cannot kill layer ".concat(e,", which does not exist"));if(this.webGLContexts[e]){var i,a=this.webGLContexts[e];null===(i=a.getExtension("WEBGL_lose_context"))||void 0===i||i.loseContext(),delete this.webGLContexts[e]}else this.canvasContexts[e]&&delete this.canvasContexts[e];return t.remove(),delete this.elements[e],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(e){this.unbindCameraHandlers(),this.camera=e,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(e){e!==this.graph&&(this.hoveredNode&&!e.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!e.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),null!==this.checkEdgesEventsFrame&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=e,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var e=this.customBBox||this.nodeExtent;return{width:e.x[1]-e.x[0]||1,height:e.y[1]-e.y[0]||1}}},{key:"getNodeDisplayData",value:function(e){var t=this.nodeDataCache[e];return t?Object.assign({},t):void 0}},{key:"getEdgeDisplayData",value:function(e){var t=this.edgeDataCache[e];return t?Object.assign({},t):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return(0,a._)({},this.settings)}},{key:"getSetting",value:function(e){return this.settings[e]}},{key:"setSetting",value:function(e,t){var i=(0,a._)({},this.settings);return this.settings[e]=t,H(this.settings),this.handleSettingsUpdate(i),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(e,t){return this.setSetting(e,t(this.settings[e])),this}},{key:"setSettings",value:function(e){var t=(0,a._)({},this.settings);return this.settings=(0,a._)((0,a._)({},this.settings),e),H(this.settings),this.handleSettingsUpdate(t),this.scheduleRefresh(),this}},{key:"resize",value:function(e){var t=this.width,i=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=N(),0===this.width){if(!this.settings.allowInvalidContainer)throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");this.width=1}if(0===this.height){if(!this.settings.allowInvalidContainer)throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");this.height=1}if(!e&&t===this.width&&i===this.height)return this;for(var a in this.elements){var n=this.elements[a];n.style.width=this.width+"px",n.style.height=this.height+"px"}for(var r in this.canvasContexts)this.elements[r].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[r].setAttribute("height",this.height*this.pixelRatio+"px"),1!==this.pixelRatio&&this.canvasContexts[r].scale(this.pixelRatio,this.pixelRatio);for(var s in this.webGLContexts){this.elements[s].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[s].setAttribute("height",this.height*this.pixelRatio+"px");var o=this.webGLContexts[s];if(o.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(s)){var h=this.textures[s];h&&o.deleteTexture(h)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(e){var t=this,i=void 0!==(null===e||void 0===e?void 0:e.skipIndexation)&&(null===e||void 0===e?void 0:e.skipIndexation),a=void 0!==(null===e||void 0===e?void 0:e.schedule)&&e.schedule,n=!e||!e.partialGraph;if(n)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode((function(e){return t.addNode(e)})),this.graph.forEachEdge((function(e){return t.addEdge(e)}));else{for(var r,s,o=(null===(r=e.partialGraph)||void 0===r?void 0:r.nodes)||[],h=0,d=(null===o||void 0===o?void 0:o.length)||0;h<d;h++){var l=o[h];if(this.updateNode(l),i){var u=this.nodeProgramIndex[l];if(void 0===u)throw new Error('Sigma: node "'.concat(l,"\" can't be repaint"));this.addNodeToProgram(l,this.nodeIndices[l],u)}}for(var c=(null===e||void 0===e||null===(s=e.partialGraph)||void 0===s?void 0:s.edges)||[],g=0,v=c.length;g<v;g++){var m=c[g];if(this.updateEdge(m),i){var f=this.edgeProgramIndex[m];if(void 0===f)throw new Error('Sigma: edge "'.concat(m,"\" can't be repaint"));this.addEdgeToProgram(m,this.edgeIndices[m],f)}}}return!n&&i||(this.needToProcess=!0),a?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var e=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame((function(){e.render()}))),this}},{key:"scheduleRefresh",value:function(e){return this.refresh((0,a._)((0,a._)({},e),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(e,t){var i=this.camera.getState(),a=i.ratio,n=i.angle,r=i.x,s=i.y,o=this.settings,h=o.minCameraRatio,d=o.maxCameraRatio;"number"===typeof d&&(t=Math.min(t,d)),"number"===typeof h&&(t=Math.max(t,h));var l=t/a,u={x:this.width/2,y:this.height/2},c=this.viewportToFramedGraph(e),g=this.viewportToFramedGraph(u);return{angle:n,x:(c.x-g.x)*(1-l)+r,y:(c.y-g.y)*(1-l)+s,ratio:t}}},{key:"viewRectangle",value:function(){var e=this.viewportToFramedGraph({x:0,y:0}),t=this.viewportToFramedGraph({x:this.width,y:0}),i=this.viewportToFramedGraph({x:0,y:this.height});return{x1:e.x,y1:e.y,x2:t.x,y2:t.y,height:t.y-i.y}}},{key:"framedGraphToViewport",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!!t.cameraState||!!t.viewportDimensions||!!t.graphDimensions,a=t.matrix?t.matrix:i?S(t.cameraState||this.camera.getState(),t.viewportDimensions||this.getDimensions(),t.graphDimensions||this.getGraphDimensions(),t.padding||this.getStagePadding()):this.matrix,n=k(a,e);return{x:(1+n.x)*this.width/2,y:(1-n.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!!t.cameraState||!!t.viewportDimensions||!t.graphDimensions,a=t.matrix?t.matrix:i?S(t.cameraState||this.camera.getState(),t.viewportDimensions||this.getDimensions(),t.graphDimensions||this.getGraphDimensions(),t.padding||this.getStagePadding(),!0):this.invMatrix,n=k(a,{x:e.x/this.width*2-1,y:1-e.y/this.height*2});return isNaN(n.x)&&(n.x=0),isNaN(n.y)&&(n.y=0),n}},{key:"viewportToGraph",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(e,t))}},{key:"graphToViewport",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(e),t)}},{key:"getGraphToViewportRatio",value:function(){var e={x:0,y:0},t={x:1,y:1},i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),a=this.graphToViewport(e),n=this.graphToViewport(t),r=Math.sqrt(Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2));return r/i}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(e){return this.customBBox=e,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);var e=this.container;while(e.firstChild)e.removeChild(e.firstChild);for(var t in this.canvasContexts={},this.webGLContexts={},this.elements={},this.nodePrograms)this.nodePrograms[t].kill();for(var i in this.nodeHoverPrograms)this.nodeHoverPrograms[i].kill();for(var a in this.edgePrograms)this.edgePrograms[a].kill();for(var n in this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={},this.elements)this.killLayer(n)}},{key:"scaleSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.camera.ratio;return e/this.settings.zoomToSizeRatioFunction(t)*("positions"===this.getSetting("itemSizesReference")?t*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var e={};for(var t in this.elements)this.elements[t]instanceof HTMLCanvasElement&&(e[t]=this.elements[t]);return e}}])}(s),xe=be}}]);